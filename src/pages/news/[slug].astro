---
import Layout from '../../layouts/Layout.astro';
import '../../styles/global.css';
import highlightsData from '../../data/highlights.json';

// Generate static paths for all highlights
export async function getStaticPaths() {
  return highlightsData.map((highlight) => ({
    params: { slug: highlight.slug },
    props: { highlight },
  }));
}

interface Props {
  highlight: {
    slug: string;
    title: string;
    date: string;
    description: string;
    category: string;
    imageSrc: string;
    featured: boolean;
    content: string;
  };
}

const { highlight } = Astro.props;

// Format date for display
const formatDate = (dateString: string) => {
  const date = new Date(dateString);
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
};
---

<Layout title={`${highlight.title} - 3rd Butterworth Company`}>
  <main>
    <!-- Hero Image Section -->
    <section class="relative h-[60vh] min-h-[400px] overflow-hidden">
      <img
        src={highlight.imageSrc}
        alt={highlight.title}
        class="w-full h-full object-cover"
        loading="eager"
      />
      <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent"></div>

      <!-- Breadcrumb and Category -->
      <div class="absolute top-8 left-0 right-0">
        <div class="max-w-4xl mx-auto px-6 sm:px-8 lg:px-12">
          <nav class="flex items-center gap-2 text-sm text-white/90 mb-4">
            <a href="/" class="hover:text-white transition-colors">Home</a>
            <span>/</span>
            <a href="/news" class="hover:text-white transition-colors">News</a>
            <span>/</span>
            <span class="text-white">{highlight.title}</span>
          </nav>
          <span class="inline-block px-3 py-1 text-xs font-semibold text-white bg-[#0071e3] rounded-full">
            {highlight.category}
          </span>
        </div>
      </div>

      <!-- Title and Date -->
      <div class="absolute bottom-0 left-0 right-0 pb-12">
        <div class="max-w-4xl mx-auto px-6 sm:px-8 lg:px-12">
          <h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold text-white mb-4 tracking-tight">
            {highlight.title}
          </h1>
          <div class="flex items-center gap-2 text-white/90">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            <time datetime={highlight.date}>
              {formatDate(highlight.date)}
            </time>
          </div>
        </div>
      </div>
    </section>

    <!-- Content Section -->
    <article class="bg-white py-16 sm:py-20 lg:py-24">
      <div class="max-w-4xl mx-auto px-6 sm:px-8 lg:px-12">
        <!-- Description -->
        <p class="text-xl sm:text-2xl text-gray-700 leading-relaxed mb-12 font-light">
          {highlight.description}
        </p>

        <!-- Main Content -->
        <div class="prose prose-lg max-w-none">
          <Fragment set:html={highlight.content
            .replace(/^## (.+)$/gm, '<h2>$1</h2>')
            .replace(/^### (.+)$/gm, '<h3>$1</h3>')
            .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
            .replace(/\*(.+?)\*/g, '<em>$1</em>')
            .replace(/^- (.+)$/gm, '<li>$1</li>')
            .replace(/(<li>.*?<\/li>\n?)+/gs, '<ul>$&</ul>')
            .split('\n\n')
            .map(para => {
              if (para.startsWith('<h') || para.startsWith('<ul')) return para;
              return `<p>${para}</p>`;
            })
            .join('\n')
          } />
        </div>

        <!-- Share Section -->
        <div class="mt-16 pt-8 border-t border-gray-200">
          <div class="flex items-center justify-between flex-wrap gap-4">
            <div class="flex items-center gap-2 text-sm text-gray-600">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
              </svg>
              <span class="font-medium">{highlight.category}</span>
            </div>
            <a
              href="/news"
              class="inline-flex items-center text-sm font-medium text-[#0071e3] hover:text-[#0077ed] transition-colors"
            >
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
              </svg>
              Back to all updates
            </a>
          </div>
        </div>
      </div>
    </article>

    <!-- Related CTA -->
    <section class="bg-gray-50 py-16 sm:py-20">
      <div class="max-w-4xl mx-auto px-6 sm:px-8 lg:px-12 text-center">
        <h2 class="text-3xl sm:text-4xl font-bold text-gray-900 mb-4">
          Stay Connected
        </h2>
        <p class="text-lg text-gray-600 mb-8">
          Don't miss out on future updates and events from the 3rd Butterworth Company.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a
            href="/activities"
            class="inline-block bg-[#0071e3] text-white px-8 py-3.5 rounded-full font-medium text-base hover:bg-[#0077ed] transition-colors duration-200 cursor-pointer"
          >
            Explore Activities
          </a>
          <a
            href="/contact"
            class="inline-block bg-white text-gray-900 border border-gray-300 px-8 py-3.5 rounded-full font-medium text-base hover:bg-gray-50 transition-colors duration-200 cursor-pointer"
          >
            Contact Us
          </a>
        </div>
      </div>
    </section>
  </main>
</Layout>

<style>
  /* Prose styling for markdown content */
  .prose {
    color: #374151;
  }

  .prose h2 {
    font-size: 1.875rem;
    font-weight: 700;
    margin-top: 2rem;
    margin-bottom: 1rem;
    color: #111827;
  }

  .prose h3 {
    font-size: 1.5rem;
    font-weight: 600;
    margin-top: 1.75rem;
    margin-bottom: 0.75rem;
    color: #111827;
  }

  .prose p {
    margin-bottom: 1.25rem;
    line-height: 1.75;
  }

  .prose ul,
  .prose ol {
    margin-bottom: 1.25rem;
    padding-left: 1.5rem;
  }

  .prose li {
    margin-bottom: 0.5rem;
  }

  .prose strong {
    font-weight: 600;
    color: #111827;
  }

  .prose a {
    color: #0071e3;
    text-decoration: none;
  }

  .prose a:hover {
    color: #0077ed;
    text-decoration: underline;
  }
</style>
